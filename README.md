# Парсер автомобилей с сайта kcar.com

## Назначение
Данный парсер предназначен для автоматизированного сбора информации о подержанных автомобилях с корейского ресурса kcar.com посредством их публичного API. Парсер реализован на фреймворке Scrapy.

## Стек технологий
- Python 3.11+
- Scrapy
- sqlite

## Запуск парсера

Активируйте виртуальную среду:
```
python -m venv venv
venv\Scripts\activate
```

Установите зависимости:
```
pip install -r requirements.txt
```

Запустите парсер — убедитесь, что находитесь в директории kcar_scraper
и выполните команду:
```
python main.py
```

## Логика работы

### Запросы
Парсер отправляет запросы к API ресурса kcar.com, используя уникальные car_id в формате EC611xxxxx или EC612xxxxx. Исходя из анализа эффективности (количества найденных машин), были выбраны только перспективные диапазоны:

```
ranges = [
    ("EC611", 22223, 33333),
    ("EC611", 33334, 44444),
    ("EC611", 44445, 55555),
    ("EC611", 55556, 66666),
    ("EC611", 66667, 77777),
    ("EC611", 77778, 88888),
    ("EC611", 88889, 99999),
    ("EC612",     0, 11111),
    ("EC612", 11112, 22222),
    ("EC612", 22223, 33333),
]
```

Каждому car_id соответствует GET-запрос к API:

```
https://api.kcar.com/bc/car-info-detail-of-ng?i_sCarCd={car_id}&i_sPassYn=N&bltbdKnd=CM050
```

Полученные данные обрабатываются методом parse_one_car, структурируются и сохраняются в базу kcar_data_scraped.sqlite.

**Для каждой машины сохраняются:**

- Уникальный ID машины (car_id)
- История аварий (accident_history_comment)
- Основная комплектация (basic_config)
- Марка (brand)
- Категория машины (car_category)
- Полное имя модели (car_full_name)
- Номерной знак (car_number_plate)
- Цвет (color)
- Тип привода (driving_type)
- Путь к изображению (elan_path)
- Объем двигателя (engine_displacement)
- Подробная комплектация (equipment_full)
- Тип топлива (fuel_type)
- Флаг аварийности (if_accident)
- Дата производства (manufacturing_date)
- Пробег (mileage)
- Модель (model)
- Фото салона (msize_img_path)
- Количество пассажиров (passenger_count)
- Цена (price_full)
- Тип трансмиссии (transmission_name)
- VIN код (vin)

### Словари

Для удобства и читаемости данных из корейского API было решено применять словари-переводчики.

**Основные словари:**

- ACCIDENT_HISTORY_COMMENT_MAP — описание истории аварий
- CAR_CATEGORY_MAP — категории автомобилей
- DRIVING_TYPE_MAP — типы привода
- FUEL_TYPE_MAP — виды топлива
- TRANSMITION_NAME_MAP — типы коробок передач

Вся логика замены корейских слов на русские реализована в файле dictionaries.py и применяется при обработке каждого автомобиля.


## Заключение
Парсер эффективно собирает и структурирует данные с kcar.com, облегчая анализ информации о подержанных автомобилях.

— buzzaggwd